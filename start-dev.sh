#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
bash check-env.sh || exit 1

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º CLIENT_URL –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω
if [ -z "$CLIENT_URL" ]; then
    export CLIENT_URL="https://${REPL_SLUG}.${REPL_OWNER}.repl.co"
    echo "‚ÑπÔ∏è  CLIENT_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: $CLIENT_URL"
    echo ""
fi

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Tip-Top –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
echo ""
echo "üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:"
echo "   - üñ•Ô∏è  –°–µ—Ä–≤–µ—Ä (Express + Socket.IO + MongoDB)"
echo "   - ü§ñ Telegram –ë–æ—Ç"
echo "   - üåê –ö–ª–∏–µ–Ω—Ç (React)"  
echo "   - üë®‚Äçüíº –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (React)"
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é server –∏ –∑–∞–ø—É—Å–∫–∞–µ–º
cd /home/runner/workspace/server

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –∏ –±–æ—Ç–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
echo "üîß –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞..."
npm run dev &
SERVER_PID=$!

echo "üîß –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
cd /home/runner/workspace/bot
npm run dev &
BOT_PID=$!

# –í dev —Ä–µ–∂–∏–º–µ –∫–ª–∏–µ–Ω—Ç –∏ –∞–¥–º–∏–Ω –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
# –í production –æ–Ω–∏ –±—É–¥—É—Ç –æ—Ç–¥–∞–≤–∞—Ç—å—Å—è –∫–∞–∫ —Å—Ç–∞—Ç–∏–∫–∞ –∏–∑ server

echo ""
echo "‚úÖ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ Tip-Top –∑–∞–ø—É—â–µ–Ω–∞!"
echo ""
echo "üìç –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:"
echo "   - API —Å–µ—Ä–≤–µ—Ä: http://localhost:3000"
echo "   - Telegram –±–æ—Ç: –∞–∫—Ç–∏–≤–µ–Ω"
echo ""
echo "üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∞–¥–º–∏–Ω–∫–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—ã:"
echo "   - –ö–ª–∏–µ–Ω—Ç: cd client && npm run dev"
echo "   - –ê–¥–º–∏–Ω: cd admin && npm run dev"
echo ""

# –î–µ—Ä–∂–∏–º –ø—Ä–æ—Ü–µ—Å—Å –∞–∫—Ç–∏–≤–Ω—ã–º
wait $SERVER_PID $BOT_PID
