#!/usr/bin/env bash
set -e

echo "üì¶ –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è production..."
echo ""

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–ø–∞–ø–∫–∞, –≥–¥–µ –ª–µ–∂–∏—Ç —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç)
cd "$(dirname "$0")"

# ===== –°–ï–†–í–ï–† =====
echo "üîß –°–±–æ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞..."
cd server
npm ci            # –ë–ï–ó --omit=dev, —Å—Ç–∞–≤–∏–º dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm run build     # –¥–æ–ª–∂–µ–Ω —Å–æ–±—Ä–∞—Ç—å dist/index.js
cd ..

# ===== –ë–û–¢ =====
echo "üîß –°–±–æ—Ä–∫–∞ –±–æ—Ç–∞..."
cd bot
npm ci            # —Ç–æ–∂–µ –±–µ–∑ --omit=dev
npm run build     # —Å–æ–±–∏—Ä–∞–µ—Ç dist/main.js
cd ..

echo ""
echo "‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–±—Ä–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
